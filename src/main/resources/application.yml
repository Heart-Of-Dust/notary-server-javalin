# src/main/resources/application.yml
app:
  name: "Trustless Notary Service"
  version: "0.1.0"
  env: ${APP_ENV:dev}

server:
  port: 7070
  host: "0.0.0.0"
  contextPath: "/api/v1"
  cors:
    enabled: false  # 内部服务，禁用CORS
  ssl:
    enabled: ${SSL_ENABLED:false}
    keystore: ${SSL_KEYSTORE_PATH:}
    keystorePassword: ${SSL_KEYSTORE_PASSWORD:}
    truststore: ${SSL_TRUSTSTORE_PATH:}
    truststorePassword: ${SSL_TRUSTSTORE_PASSWORD:}
    clientAuth: "REQUIRE"  # 强制mTLS

security:
  masterKey: ${MASTER_KEY_ENV:}  # 从环境变量获取
  hsm:
    enabled: ${HSM_ENABLED:false}
    provider: "SunPKCS11"
    config: ${HSM_CONFIG_PATH:/etc/hsm/config.cfg}
    pin: ${HSM_PIN:}
  tsa:
    rootCert: "classpath:certs/tsa_root.pem"
    allowedDriftMs: 90000    # 90秒
    tokenTtlMs: 300000       # 5分钟

database:
  url: jdbc:postgresql://localhost:5432/notary_db
  username: notary_user
  password: 123456
  driverClassName: org.postgresql.Driver
  hikari:
    maximumPoolSize: 10
    minimumIdle: 2
    connectionTimeout: 30000
    idleTimeout: 600000
    maxLifetime: 1800000

redis:
  host: ${REDIS_HOST:localhost}
  port: ${REDIS_PORT:6379}
  password: ${REDIS_PASSWORD:}
  database: 0
  timeout: 2000
  ssl: ${REDIS_SSL:false}
  jedis:
    pool:
      maxTotal: 8
      maxIdle: 8
      minIdle: 0

logging:
  level:
    com.notary: DEBUG
    org.hibernate.SQL: WARN
    org.hibernate.type: WARN
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} - %highlight(%-5level) - %cyan(%logger{36}) - %msg%n"
    file: "%d{yyyy-MM-dd HH:mm:ss} - %-5level - %logger{36} - %msg%n"
  file:
    name: "logs/notary-service.log"
    maxHistory: 30
    maxSize: 100MB